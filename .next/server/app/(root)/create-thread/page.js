(()=>{var e={};e.id=9572,e.ids=[9572],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},10467:e=>{"use strict";e.exports=require("next/dist/compiled/@vercel/og/index.node.js")},41790:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},57147:e=>{"use strict";e.exports=require("fs")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},87503:e=>{"use strict";e.exports=require("node:net")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},84492:e=>{"use strict";e.exports=require("node:stream")},72477:e=>{"use strict";e.exports=require("node:stream/web")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},65628:e=>{"use strict";e.exports=require("node:zlib")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},53762:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>h,originalPathname:()=>p,pages:()=>u,routeModule:()=>m,tree:()=>l});var a=r(73137),n=r(54647),o=r(4183),s=r.n(o),d=r(71775),i={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>d[e]);r.d(t,i);let c=a.AppPageRouteModule,l=["",{children:["(root)",{children:["create-thread",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,54597)),"C:\\Users\\lynda\\OneDrive\\Desktop\\GitHub2_Projects\\threads\\app\\(root)\\create-thread\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,83537)),"C:\\Users\\lynda\\OneDrive\\Desktop\\GitHub2_Projects\\threads\\app\\(root)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,51918,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,51918,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["C:\\Users\\lynda\\OneDrive\\Desktop\\GitHub2_Projects\\threads\\app\\(root)\\create-thread\\page.tsx"],p="/(root)/create-thread/page",h={require:r,loadChunk:()=>Promise.resolve()},m=new c({definition:{kind:n.x.APP_PAGE,page:"/(root)/create-thread/page",pathname:"/create-thread",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},7775:(e,t,r)=>{let a={"38d2d7a0a35de985e321f749280c69191b8c2814":()=>Promise.resolve().then(r.bind(r,43073)).then(e=>e.fetchPosts),"78e111e9dc41efac987bd5e8ac51b19043c9068a":()=>Promise.resolve().then(r.bind(r,43073)).then(e=>e.createThread),b5742e553fecb2b810f82b514ddc398a21ae6ac0:()=>Promise.resolve().then(r.bind(r,43073)).then(e=>e.deleteThread),"39784508112122b2d6fe16b8d277c4cb71a3d20d":()=>Promise.resolve().then(r.bind(r,43073)).then(e=>e.fetchThreadById),e5fb2a651b5b7a205c654d5be1a786f5e317b9d1:()=>Promise.resolve().then(r.bind(r,43073)).then(e=>e.addCommentToThread)};async function n(e,...t){let r=await a[e]();return r.apply(null,t)}e.exports={"38d2d7a0a35de985e321f749280c69191b8c2814":n.bind(null,"38d2d7a0a35de985e321f749280c69191b8c2814"),"78e111e9dc41efac987bd5e8ac51b19043c9068a":n.bind(null,"78e111e9dc41efac987bd5e8ac51b19043c9068a"),b5742e553fecb2b810f82b514ddc398a21ae6ac0:n.bind(null,"b5742e553fecb2b810f82b514ddc398a21ae6ac0"),"39784508112122b2d6fe16b8d277c4cb71a3d20d":n.bind(null,"39784508112122b2d6fe16b8d277c4cb71a3d20d"),e5fb2a651b5b7a205c654d5be1a786f5e317b9d1:n.bind(null,"e5fb2a651b5b7a205c654d5be1a786f5e317b9d1")}},63706:(e,t,r)=>{Promise.resolve().then(r.bind(r,18149)),Promise.resolve().then(r.bind(r,16373)),Promise.resolve().then(r.bind(r,52990)),Promise.resolve().then(r.bind(r,84102)),Promise.resolve().then(r.bind(r,54390)),Promise.resolve().then(r.t.bind(r,42796,23))},18149:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(60080),n=r(66558),o=r(68384),s=r(60806),d=r(83894),i=r(76466),c=r(63758),l=r(21510);r(4047);var u=r(57114),p=r(74233);let h=function({userId:e}){let t=(0,u.useRouter)(),r=(0,u.usePathname)(),h=(0,c.o8)(),m=(0,n.cI)({resolver:(0,d.F)(l.A),defaultValues:{thread:"",accountId:e}}),f=async a=>{await (0,p.gK)({text:a.thread,author:e,communityId:h?h.id:null,path:r}),t.push("/")};return a.jsx(s.l0,{...m,children:(0,a.jsxs)("form",{onSubmit:m.handleSubmit(f),className:"flex flex-col justify-start gap-10",children:[a.jsx(s.Wi,{control:m.control,name:"thread",render:({field:e})=>(0,a.jsxs)(s.xJ,{className:"flex w-full flex-col gap-3",children:[a.jsx(s.lX,{className:"text-base-semibold text-light-2",children:"Content"}),a.jsx(s.NI,{className:"no-focus border border-dark-4 bg-dark-3 text-light-1",children:a.jsx(i.g,{rows:15,...e})}),a.jsx(s.zG,{})]})}),a.jsx(o.z,{type:"submit",className:"bg-primary-500",children:"Post Thread"})]})})}},76466:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});var a=r(60080),n=r(9885),o=r(23161);let s=n.forwardRef(({className:e,...t},r)=>a.jsx("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus-visible:ring-slate-300",e),ref:r,...t}));s.displayName="Textarea"},54597:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(48144),n=r(17536);let o=(0,n.createProxy)(String.raw`C:\Users\lynda\OneDrive\Desktop\GitHub2_Projects\threads\components\forms\PostThread.tsx`),{__esModule:s,$$typeof:d}=o,i=o.default;var c=r(89822),l=r(98620),u=r(6465);async function p(){let e=await (0,l.ar)();if(!e)return null;let t=await (0,c.fetchUser)(e.id);return t?.onboarded||(0,u.redirect)("/onboarding"),(0,a.jsxs)(a.Fragment,{children:[a.jsx("h1",{className:"head-text",children:"Create Threads"}),a.jsx(i,{userId:t._id})]})}let h=p},43073:(e,t,r)=>{"use strict";r.r(t),r.d(t,{addCommentToThread:()=>m,createThread:()=>l,deleteThread:()=>p,fetchPosts:()=>c,fetchThreadById:()=>h});var a=r(57016),n=r(20738),o=r(27977),s=r(9245),d=r(74975),i=r(88832);async function c(e=1,t=20){(0,o.connectToDB)();let r=(e-1)*t,a=d.default.find({parentId:{$in:[null,void 0]}}).sort({createdAt:"desc"}).skip(r).limit(t).populate({path:"author",model:s.default}).populate({path:"community",model:i.default}).populate({path:"children",populate:{path:"author",model:s.default,select:"_id name parentId image"}}),n=await d.default.countDocuments({parentId:{$in:[null,void 0]}}),c=await a.exec(),l=n>r+c.length;return{posts:c,isNext:l}}async function l({text:e,author:t,communityId:r,path:a}){try{(0,o.connectToDB)();let c=await i.default.findOne({id:r},{_id:1}),l=await d.default.create({text:e,author:t,community:c});await s.default.findByIdAndUpdate(t,{$push:{threads:l._id}}),c&&await i.default.findByIdAndUpdate(c,{$push:{threads:l._id}}),(0,n.revalidatePath)(a)}catch(e){throw Error(`Failed to create thread: ${e.message}`)}}async function u(e){let t=await d.default.find({parentId:e}),r=[];for(let e of t){let t=await u(e._id);r.push(e,...t)}return r}async function p(e,t){try{(0,o.connectToDB)();let r=await d.default.findById(e).populate("author community");if(!r)throw Error("Thread not found");let a=await u(e),c=[e,...a.map(e=>e._id)],l=new Set([...a.map(e=>e.author?._id?.toString()),r.author?._id?.toString()].filter(e=>void 0!==e)),p=new Set([...a.map(e=>e.community?._id?.toString()),r.community?._id?.toString()].filter(e=>void 0!==e));await d.default.deleteMany({_id:{$in:c}}),await s.default.updateMany({_id:{$in:Array.from(l)}},{$pull:{threads:{$in:c}}}),await i.default.updateMany({_id:{$in:Array.from(p)}},{$pull:{threads:{$in:c}}}),(0,n.revalidatePath)(t)}catch(e){throw Error(`Failed to delete thread: ${e.message}`)}}async function h(e){(0,o.connectToDB)();try{let t=await d.default.findById(e).populate({path:"author",model:s.default,select:"_id id name image"}).populate({path:"community",model:i.default,select:"_id id name image"}).populate({path:"children",populate:[{path:"author",model:s.default,select:"_id id name parentId image"},{path:"children",model:d.default,populate:{path:"author",model:s.default,select:"_id id name parentId image"}}]}).exec();return t}catch(e){throw console.error("Error while fetching thread:",e),Error("Unable to fetch thread")}}async function m(e,t,r,a){(0,o.connectToDB)();try{let o=await d.default.findById(e);if(!o)throw Error("Thread not found");let s=new d.default({text:t,author:r,parentId:e}),i=await s.save();o.children.push(i._id),await o.save(),(0,n.revalidatePath)(a)}catch(e){throw console.error("Error while adding comment:",e),Error("Unable to add comment")}}(0,r(96276).ensureServerEntryExports)([c,l,p,h,m]),(0,a.createActionProxy)("38d2d7a0a35de985e321f749280c69191b8c2814",null,c),(0,a.createActionProxy)("78e111e9dc41efac987bd5e8ac51b19043c9068a",null,l),(0,a.createActionProxy)("b5742e553fecb2b810f82b514ddc398a21ae6ac0",null,p),(0,a.createActionProxy)("39784508112122b2d6fe16b8d277c4cb71a3d20d",null,h),(0,a.createActionProxy)("e5fb2a651b5b7a205c654d5be1a786f5e317b9d1",null,m)},88832:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var a=r(11185),n=r.n(a);let o=new(n()).Schema({id:{type:String,required:!0},username:{type:String,unique:!0,required:!0},name:{type:String,required:!0},image:String,bio:String,createdBy:{type:n().Schema.Types.ObjectId,ref:"User"},threads:[{type:n().Schema.Types.ObjectId,ref:"Thread"}],members:[{type:n().Schema.Types.ObjectId,ref:"User"}]}),s=n().models.Community||n().model("Community",o),d=s},74975:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var a=r(11185),n=r.n(a);let o=new(n()).Schema({text:{type:String,required:!0},author:{type:n().Schema.Types.ObjectId,ref:"User",required:!0},community:{type:n().Schema.Types.ObjectId,ref:"Community"},createdAt:{type:Date,default:Date.now()},parentId:{type:String},children:[{type:n().Schema.Types.ObjectId,ref:"Thread"}]}),s=n().models.Thread||n().model("Thread",o),d=s},9245:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var a=r(11185),n=r.n(a);let o=new(n()).Schema({id:{type:String,required:!0},username:{type:String,required:!0,unique:!0},name:{type:String,required:!0},image:String,bio:String,threads:[{type:n().Schema.Types.ObjectId,ref:"Thread"}],onboarded:{type:Boolean,default:!1},communities:[{type:n().Schema.Types.ObjectId,ref:"Community"}]}),s=n().models.User||n().model("User",o),d=s},27977:(e,t,r)=>{"use strict";r.d(t,{connectToDB:()=>s});var a=r(11185),n=r.n(a);let o=!1,s=async()=>{if(n().set("strictQuery",!0),!process.env.MONGODB_URL)return console.log("MONGODB_URL not found");if(o)return console.log("Already connected to MongoDB");try{await n().connect(process.env.MONGODB_URL),o=!0,console.log("Connected to MongoDB")}catch(e){console.log(e)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4650,1421,7375,8620,2107,6248,5717,8242,8788,3406,8415,7297,3979,1971,6785,3938,3474,1397,7792,3638,9822,6404,3161,8384,1748,1949],()=>r(53762));module.exports=a})();