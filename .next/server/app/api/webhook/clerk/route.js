"use strict";(()=>{var e={};e.id=240,e.ids=[240],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},73125:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>k,requestAsyncStorage:()=>_,routeModule:()=>j,serverHooks:()=>S,staticGenerationAsyncStorage:()=>O,staticGenerationBailout:()=>U});var a={};r.r(a),r.d(a,{POST:()=>x}),r(95655);var o=r(83323),n=r(54647),i=r(63866),s=r(59859),c=r(66886),d=r(10459),u=r(41035),l=r(9148),m=r(98024),p=r(78291);async function h(e,t,r,a,o,n){try{(0,p.P)();let i=await m.Z.findOne({id:n});if(!i)throw Error("User not found");let s=new u.Z({id:e,name:t,username:r,image:a,bio:o,createdBy:i._id}),c=await s.save();return i.communities.push(c._id),await i.save(),c}catch(e){throw console.error("Error creating community:",e),e}}async function g(e){try{(0,p.P)();let t=await u.Z.findOne({id:e}).populate(["createdBy",{path:"members",model:m.Z,select:"name username image _id id"}]);return t}catch(e){throw console.error("Error fetching community details:",e),e}}async function f(e){try{(0,p.P)();let t=await u.Z.findById(e).populate({path:"threads",model:l.Z,populate:[{path:"author",model:m.Z,select:"name image id"},{path:"children",model:l.Z,populate:{path:"author",model:m.Z,select:"image _id"}}]});return t}catch(e){throw console.error("Error fetching community posts:",e),e}}async function y({searchString:e="",pageNumber:t=1,pageSize:r=20,sortBy:a="desc"}){try{(0,p.P)();let o=(t-1)*r,n=RegExp(e,"i"),i={};""!==e.trim()&&(i.$or=[{username:{$regex:n}},{name:{$regex:n}}]);let s=u.Z.find(i).sort({createdAt:a}).skip(o).limit(r).populate("members"),c=await u.Z.countDocuments(i),d=await s.exec(),l=c>o+d.length;return{communities:d,isNext:l}}catch(e){throw console.error("Error fetching communities:",e),e}}async function w(e,t){try{(0,p.P)();let r=await u.Z.findOne({id:e});if(!r)throw Error("Community not found");let a=await m.Z.findOne({id:t});if(!a)throw Error("User not found");if(r.members.includes(a._id))throw Error("User is already a member of the community");return r.members.push(a._id),await r.save(),a.communities.push(r._id),await a.save(),r}catch(e){throw console.error("Error adding member to community:",e),e}}async function b(e,t){try{(0,p.P)();let r=await m.Z.findOne({id:e},{_id:1}),a=await u.Z.findOne({id:t},{_id:1});if(!r)throw Error("User not found");if(!a)throw Error("Community not found");return await u.Z.updateOne({_id:a._id},{$pull:{members:r._id}}),await m.Z.updateOne({_id:r._id},{$pull:{communities:a._id}}),{success:!0}}catch(e){throw console.error("Error removing user from community:",e),e}}async function v(e,t,r,a){try{(0,p.P)();let o=await u.Z.findOneAndUpdate({id:e},{name:t,username:r,image:a});if(!o)throw Error("Community not found");return o}catch(e){throw console.error("Error updating community information:",e),e}}async function Z(e){try{(0,p.P)();let t=await u.Z.findOneAndDelete({id:e});if(!t)throw Error("Community not found");await l.Z.deleteMany({community:e});let r=await m.Z.find({communities:e}),a=r.map(t=>(t.communities.pull(e),t.save()));return await Promise.all(a),t}catch(e){throw console.error("Error deleting community: ",e),e}}(0,r(51419).h)([h,g,f,y,w,b,v,Z]),(0,d.U)("195efa463311e05eb029e1be3158272996a9eaa5",null,h),(0,d.U)("3a03bb0e50f5d9105c5c067b12badbe8746d7721",null,g),(0,d.U)("d7399e4808513252d730cd406fedd268b2c0f2ae",null,f),(0,d.U)("565693973b96ea8398aac4bd71a4e7f700c0172f",null,y),(0,d.U)("664aea410deb799e92538aa56dd13d6a5da86de3",null,w),(0,d.U)("e79b8e48dc4a5a06a020e1052566879c3b58203a",null,b),(0,d.U)("92a3a8c87c767025e188c4a1ff63ce80d9afb2bc",null,v),(0,d.U)("a895507cbdcba55b037778cb26c87c24fe7c69b4",null,Z);let x=async e=>{let t=await e.json(),r=(0,s.headers)(),a={"svix-id":r.get("svix-id"),"svix-timestamp":r.get("svix-timestamp"),"svix-signature":r.get("svix-signature")},o=new i.Webhook(process.env.NEXT_CLERK_WEBHOOK_SECRET||""),n=null;try{n=o.verify(JSON.stringify(t),a)}catch(e){return c.Z.json({message:e},{status:400})}let d=n?.type;if("organization.created"===d){let{id:e,name:t,slug:r,logo_url:a,image_url:o,created_by:i}=n?.data??{};try{return await h(e,t,r,a||o,"org bio",i),c.Z.json({message:"User created"},{status:201})}catch(e){return console.log(e),c.Z.json({message:"Internal Server Error"},{status:500})}}if("organizationInvitation.created"===d)try{return console.log("Invitation created",n?.data),c.Z.json({message:"Invitation created"},{status:201})}catch(e){return console.log(e),c.Z.json({message:"Internal Server Error"},{status:500})}if("organizationMembership.created"===d)try{let{organization:e,public_user_data:t}=n?.data;return console.log("created",n?.data),await w(e.id,t.user_id),c.Z.json({message:"Invitation accepted"},{status:201})}catch(e){return console.log(e),c.Z.json({message:"Internal Server Error"},{status:500})}if("organizationMembership.deleted"===d)try{let{organization:e,public_user_data:t}=n?.data;return console.log("removed",n?.data),await b(t.user_id,e.id),c.Z.json({message:"Member removed"},{status:201})}catch(e){return console.log(e),c.Z.json({message:"Internal Server Error"},{status:500})}if("organization.updated"===d)try{let{id:e,logo_url:t,name:r,slug:a}=n?.data;return console.log("updated",n?.data),await v(e,r,a,t),c.Z.json({message:"Member removed"},{status:201})}catch(e){return console.log(e),c.Z.json({message:"Internal Server Error"},{status:500})}if("organization.deleted"===d)try{let{id:e}=n?.data;return console.log("deleted",n?.data),await Z(e),c.Z.json({message:"Organization deleted"},{status:201})}catch(e){return console.log(e),c.Z.json({message:"Internal Server Error"},{status:500})}},E=o.AppRouteRouteModule,j=new E({definition:{kind:n.x.APP_ROUTE,page:"/api/webhook/clerk/route",pathname:"/api/webhook/clerk",filename:"route",bundlePath:"app/api/webhook/clerk/route"},resolvedPagePath:"C:\\Users\\lynda\\OneDrive\\Desktop\\GitHub2_Projects\\threads\\app\\api\\webhook\\clerk\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:O,serverHooks:S,headerHooks:q,staticGenerationBailout:U}=j,k="/api/webhook/clerk/route"},41035:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),o=r.n(a);let n=new(o()).Schema({id:{type:String,required:!0},username:{type:String,unique:!0,required:!0},name:{type:String,required:!0},image:String,bio:String,createdBy:{type:o().Schema.Types.ObjectId,ref:"User"},threads:[{type:o().Schema.Types.ObjectId,ref:"Thread"}],members:[{type:o().Schema.Types.ObjectId,ref:"User"}]}),i=o().models.Community||o().model("Community",n),s=i}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4650,1421,8788,9727,3866,7792],()=>r(73125));module.exports=a})();